# CiviCRM 5.4.0

Released August 1, 2018

- **[Synopsis](#synopsis)**
- **[Features](#features)**
- **[Bugs resolved](#bugs)**
- **[Miscellany](#misc)**
- **[Credits](#credits)**
- **[Feedback](#feedback)**

## <a name="synopsis"></a>Synopsis

| *Does this version...?*                                         |         |
|:--------------------------------------------------------------- |:-------:|
| Fix security vulnerabilities?                                   |         |
| Change the database schema?                                     |         |
| Alter the API?                                                  |         |
| Require attention to configuration options?                     |         |
| Fix problems installing or upgrading to a previous version?     |         |
| Introduce features?                                             |         |
| Fix bugs?                                                       |         |

## <a name="features"></a>Features

### Core CiviCRM

- **[CRM-21574](https://issues.civicrm.org/jira/browse/CRM-21574) Allow to disable sending of email from source contact for tell a friend on pcp ([12355](https://github.com/civicrm/civicrm-core/pull/12355))**

- **[CRM-21392](https://issues.civicrm.org/jira/browse/CRM-21392) Allow viewing groups/smartgroups as as other entities (eg. memberships, events) ([11241](https://github.com/civicrm/civicrm-core/pull/11241))**

- **[CRM-21622](https://issues.civicrm.org/jira/browse/CRM-21622) Make the Add Parent Groups on Group Settings be a multiselect ([11481](https://github.com/civicrm/civicrm-core/pull/11481))**

- **[CRM-21808](https://issues.civicrm.org/jira/browse/CRM-21808) Install custom group for Contribution or ContributioRecur subtypes based on XML file ([11726](https://github.com/civicrm/civicrm-core/pull/11726))**

- **[CRM-21460](https://issues.civicrm.org/jira/browse/CRM-21460) Programmatic access to job execution status ([11337](https://github.com/civicrm/civicrm-core/pull/11337))**

### Accounting Integration

- **[CRM-21637](https://issues.civicrm.org/jira/browse/CRM-21637) Search Criteria for Card Type ID and Card Number not respected in Batch ([11495](https://github.com/civicrm/civicrm-core/pull/11495))**

### CiviReport

- **[CRM-20430](https://issues.civicrm.org/jira/browse/CRM-20430) A permission 'save Report Criteria' ([12107](https://github.com/civicrm/civicrm-core/pull/12107))**

## <a name="bugs"></a>Bugs resolved

### Core CiviCRM

- **(dev/core#284) System::flushCache - Reproduce legacy cache behavior. Improve test performance. ([12590](https://github.com/civicrm/civicrm-core/pull/12590))**

- **Backport "Fix regression on case export" to 5.4 ([12588](https://github.com/civicrm/civicrm-core/pull/12588))**

- **dev/279 - When Merging two contacts flip, prev, next not working ([12568](https://github.com/civicrm/civicrm-core/pull/12568))**

- **dev/core#276 enotice fix ([12563](https://github.com/civicrm/civicrm-core/pull/12563))**

- **Handle 'Check for Matching Contact(s)' button with ajax ([12552](https://github.com/civicrm/civicrm-core/pull/12552))**

- **Included missed 5.3 commits ([12551](https://github.com/civicrm/civicrm-core/pull/12551))**

- **dev/core#131 Stop Monmouthshire from breaking upgrades ([12538](https://github.com/civicrm/civicrm-core/pull/12538))**

- **(NFC) Convert files to use linux line endings not windows ([12531](https://github.com/civicrm/civicrm-core/pull/12531))**

- **dev/core#272 : Fatal Error (Regression) on PCP pages associated with Events ([12533](https://github.com/civicrm/civicrm-core/pull/12533))**

- **(Forward port) Add Smarty modifier to purify HTML ([12519](https://github.com/civicrm/civicrm-core/pull/12519))**

- **Update 5.3.1 Release Notes to include final SA ([12514](https://github.com/civicrm/civicrm-core/pull/12514))**

- **Fix misformatted start_date default on new contribution page ([12504](https://github.com/civicrm/civicrm-core/pull/12504))**

- **dev/core/#/258 Fix message update routine. ([12492](https://github.com/civicrm/civicrm-core/pull/12492))**

- **Prevent financial transactions from being saved with no payment instr… ([12502](https://github.com/civicrm/civicrm-core/pull/12502))**

- **dev/core#249 Fix crash when performing export all contacts from search ([12447](https://github.com/civicrm/civicrm-core/pull/12447))**

- **Follow up to PR 12160 to update the DB version of the templates ([12417](https://github.com/civicrm/civicrm-core/pull/12417))**

- **Change default for CIVICRM_CONTAINER_CACHE to simplify admin/developer experience ([12426](https://github.com/civicrm/civicrm-core/pull/12426))**

- **Ensure db updates are run for 5.3.alpha1 ([12425](https://github.com/civicrm/civicrm-core/pull/12425))**

- **dev/core#234 Move all steps from 5.3.alpha1.mysql.tpl to 5.3.0.mysql.tpl due to upgrade issues ([12420](https://github.com/civicrm/civicrm-core/pull/12420))**

- **Ensure that the .mysql.tpl file is run for 5.3.alpha1 ([12419](https://github.com/civicrm/civicrm-core/pull/12419))**

- **dev/core#107: Add default assignee when creating cases ([11998](https://github.com/civicrm/civicrm-core/pull/11998))**

- **Fix sample custom data is_reserved=0 ([12411](https://github.com/civicrm/civicrm-core/pull/12411))**

- **5.3 ([12403](https://github.com/civicrm/civicrm-core/pull/12403))**

- **dev/core#155 Improve Option Groups form ([12233](https://github.com/civicrm/civicrm-core/pull/12233))**

- **Use email_greeting where possible in receipts ([12296](https://github.com/civicrm/civicrm-core/pull/12296))**

- **(dev/core#174) Forms/Sessions - Store state via Civi::cache('session') ([12362](https://github.com/civicrm/civicrm-core/pull/12362))**

- **Revert change to BillingBlock to support hidden fields. ([12391](https://github.com/civicrm/civicrm-core/pull/12391))**

- **(dev/core#223) Expose prefix and suffix in reports ([12394](https://github.com/civicrm/civicrm-core/pull/12394))**

- **dev/core#222 - Fix importing contacts with dedupe rule ([12393](https://github.com/civicrm/civicrm-core/pull/12393))**

- **(dev/core#174) Add test to prevent hidden interactions among caches ([12389](https://github.com/civicrm/civicrm-core/pull/12389))**

- **Move DAO function to DAO class, call it from Merge class ([12340](https://github.com/civicrm/civicrm-core/pull/12340))**

- **(dev/core#220) State province/country doesn't show properly in the… ([12390](https://github.com/civicrm/civicrm-core/pull/12390))**

- **(dev/core#174) Full PSR-16 compliance for SqlGroup ([12379](https://github.com/civicrm/civicrm-core/pull/12379))**

- **NFC code cleanup for AuthNet, Paypal, PaypalPro IPNs ([12386](https://github.com/civicrm/civicrm-core/pull/12386))**

- **dev/core#195 Add Contribution Counts to Sub-tabs ([12345](https://github.com/civicrm/civicrm-core/pull/12345))**

- **5.3 to master ([12383](https://github.com/civicrm/civicrm-core/pull/12383))**

- **dev/core/issues/202, check if default currency is set ([12356](https://github.com/civicrm/civicrm-core/pull/12356))**

- **(dev/core#174) APCcache - Updates to comply with PSR-16 ([12381](https://github.com/civicrm/civicrm-core/pull/12381))**

- **(dev/core#174) Memcache(d) - Updates to comply with PSR-16 ([12380](https://github.com/civicrm/civicrm-core/pull/12380))**

- **(dev/core#174) Full PSR-16 compliance for ArrayCache, Redis ([12378](https://github.com/civicrm/civicrm-core/pull/12378))**

- **CiviCase, added reference of activities from different timelines. ([12236](https://github.com/civicrm/civicrm-core/pull/12236))**

- **(dev/core#174) Add various utilities to support PSR-16 ([12376](https://github.com/civicrm/civicrm-core/pull/12376))**

- **(dev/core#174) civicrm_cache - Finish transition from DATETIME to TIMESTAMP ([12368](https://github.com/civicrm/civicrm-core/pull/12368))**

- **core/issues#96 - Expose source column in booking report ([12374](https://github.com/civicrm/civicrm-core/pull/12374))**

- **Caching - Comply with PSR-16 interfaces ([12342](https://github.com/civicrm/civicrm-core/pull/12342))**

- **(dev/core#174) Cache-keys for CRM_Utils_Cache_* should avoid reserved chars ([12348](https://github.com/civicrm/civicrm-core/pull/12348))**

- ** (dev/core#174) civicrm_cache - Allow storage of binary data  ([12354](https://github.com/civicrm/civicrm-core/pull/12354))**

- **dev/core#41: Added unit test ([12363](https://github.com/civicrm/civicrm-core/pull/12363))**

- **dev/core/issues/203, removed cruft code ([12357](https://github.com/civicrm/civicrm-core/pull/12357))**

- **Add support for hidden fields in general (and 'token' specifically) on the payment form. ([12332](https://github.com/civicrm/civicrm-core/pull/12332))**

- **dev/core#41: Search Builder: Not empty with date or integer custom fields gives a sql warning ([12351](https://github.com/civicrm/civicrm-core/pull/12351))**

- **dev/core#187 Fix typo in CRM_Grant_Form_Task that prevents retrieving session key from URL ([12317](https://github.com/civicrm/civicrm-core/pull/12317))**

- **Fix profile load on update multiple action ([12349](https://github.com/civicrm/civicrm-core/pull/12349))**

- **(NFC) CiviUnitTestCase - Fix edge-case for mis-reported error ([12347](https://github.com/civicrm/civicrm-core/pull/12347))**

- **(dev/core#174) CRM_Utils_Cache - Always use a prefix. Standardize delimiter ([12331](https://github.com/civicrm/civicrm-core/pull/12331))**

- **dev/core#151: Allow to Edit Recurring Contributions From Membership ([12228](https://github.com/civicrm/civicrm-core/pull/12228))**

- **dev/membership#4 - Admin Membership type is displayed on Public contr… ([12178](https://github.com/civicrm/civicrm-core/pull/12178))**

- **Remove unused instances of usedTable ([12341](https://github.com/civicrm/civicrm-core/pull/12341))**

- **Use html5 color input for contribution page widget ([12339](https://github.com/civicrm/civicrm-core/pull/12339))**

- **NFC Code cleanup to core task class ([12316](https://github.com/civicrm/civicrm-core/pull/12316))**

- **(dev/core#174) systemStatusCheckResult - Migrate from settings to cache ([12336](https://github.com/civicrm/civicrm-core/pull/12336))**

- **(dev/core#174) CRM_Utils_Cache_Redis::flush() - Respect prefixes ([12330](https://github.com/civicrm/civicrm-core/pull/12330))**

- **Ensure classes are the same across all workflow templates ([12338](https://github.com/civicrm/civicrm-core/pull/12338))**

- **Add in bootstrap button classes to CiviMail interface ([12013](https://github.com/civicrm/civicrm-core/pull/12013))**

- **5.3 merge to master ([12335](https://github.com/civicrm/civicrm-core/pull/12335))**

- **dev/core/#133 Make Conditions Stricter When Checking If Reply-To Field Is Empty ([12176](https://github.com/civicrm/civicrm-core/pull/12176))**

- **[NFC] Stop passing no-longer-part-of-signature variable ([12329](https://github.com/civicrm/civicrm-core/pull/12329))**

- **Cleanup of api_v3_membership_create towards #11556 ([12313](https://github.com/civicrm/civicrm-core/pull/12313))**

- **(dev/core#174) Remove reference to unused `modulePaths` ([12322](https://github.com/civicrm/civicrm-core/pull/12322))**

- **(dev/core#183) Temporary tables should follow consistent naming convention ([12311](https://github.com/civicrm/civicrm-core/pull/12311))**

- **dev/core#124 Enhancements for events requiring approval ([12160](https://github.com/civicrm/civicrm-core/pull/12160))**

- **(NFC) dev/core#174 - CRM_Utils_System::flushCache - Remove dead code ([12323](https://github.com/civicrm/civicrm-core/pull/12323))**

- **5.3 to master ([12328](https://github.com/civicrm/civicrm-core/pull/12328))**

- **Fix typo in api explorer sample code ([12324](https://github.com/civicrm/civicrm-core/pull/12324))**

- **(dev/core#174) api_v3_SettingTest - Remove dead code ([12321](https://github.com/civicrm/civicrm-core/pull/12321))**

- **Cleanup recordAdditionalPayment towards #11556 ([12314](https://github.com/civicrm/civicrm-core/pull/12314))**

- **Make all form tasks inherit from Core_Form_Task ([12318](https://github.com/civicrm/civicrm-core/pull/12318))**

- **dev/core#144 getCustomFieldID switch to API, add caching, add full string return option ([12218](https://github.com/civicrm/civicrm-core/pull/12218))**

- **dev/core#88 Make sure financial_type_id is set when contribution is created ([11907](https://github.com/civicrm/civicrm-core/pull/11907))**

- **(dev/core#178) Redis - Report error messages ([12303](https://github.com/civicrm/civicrm-core/pull/12303))**

- **[CRM-21854](https://issues.civicrm.org/jira/browse/CRM-21854) Contribution start date and end dates are not respected ([11881](https://github.com/civicrm/civicrm-core/pull/11881))**

- **Fix for #180: passing the entity ID to the custom hook when deleting a custom value ([12309](https://github.com/civicrm/civicrm-core/pull/12309))**

- **Fix access to scheduled reminders for admins without event access ([11733](https://github.com/civicrm/civicrm-core/pull/11733))**

- **Only treat a request as a get request (and hence use GET) if it starts with get ([12308](https://github.com/civicrm/civicrm-core/pull/12308))**

- **(dev/core#179) Redis - Only send AUTH if there's a password ([12304](https://github.com/civicrm/civicrm-core/pull/12304))**

- **dev/core#24 Passing an array for contact_id/client_id to Case.Create API when updating an existing case causes case to be "reassigned" ([11830](https://github.com/civicrm/civicrm-core/pull/11830))**

- **(dev/core#177) Redis::get() should return NULL for undefined cache keys ([12302](https://github.com/civicrm/civicrm-core/pull/12302))**

- **dev/core#175 - Smart group involving relationship type filter display… ([12301](https://github.com/civicrm/civicrm-core/pull/12301))**

- **Add testing to contribution detail report, covering dev/core/issues#170 ([12281](https://github.com/civicrm/civicrm-core/pull/12281))**

- **core-32 - Add option to disable cancel button on a profile form ([11883](https://github.com/civicrm/civicrm-core/pull/11883))**

- **[CRM-21815](https://issues.civicrm.org/jira/browse/CRM-21815) On re-opening a civicase - Case Coordinator (and other roles) are not reinstated ([11736](https://github.com/civicrm/civicrm-core/pull/11736))**

- **Fix e-notice, remove legacy code pattern ([12298](https://github.com/civicrm/civicrm-core/pull/12298))**

- **Remove unused code variable ([12299](https://github.com/civicrm/civicrm-core/pull/12299))**

- **(dev/core/56) Cancel Recurring Contribution activity should has a source record id ([11964](https://github.com/civicrm/civicrm-core/pull/11964))**

- **5.3 ([12300](https://github.com/civicrm/civicrm-core/pull/12300))**

- **Confirm & lock in group.get handling of is_active ([12295](https://github.com/civicrm/civicrm-core/pull/12295))**

- **5.3 ([12297](https://github.com/civicrm/civicrm-core/pull/12297))**

- **Remove unused function getRecuringTransactionStatus from PayflowPro c… ([12294](https://github.com/civicrm/civicrm-core/pull/12294))**

- **Add upgrade function for message templates that does not involve copying the whole template ([12224](https://github.com/civicrm/civicrm-core/pull/12224))**

- **Function extraction BAO_Export class ([12288](https://github.com/civicrm/civicrm-core/pull/12288))**

- **dev/core#47 Add clone scheduled job functionality ([11945](https://github.com/civicrm/civicrm-core/pull/11945))**

- **Make Send SMS permission independent of Edit Contact permission ([12067](https://github.com/civicrm/civicrm-core/pull/12067))**

- **(dev/core/50) Add Separate Sub-tabs for Contributions and Recurring Contributions ([11956](https://github.com/civicrm/civicrm-core/pull/11956))**

- **dev/core/#101: Allow further customization of search form in hooks ([12078](https://github.com/civicrm/civicrm-core/pull/12078))**

- **CiviMail: If SMTP connection error is detected, disconnect so we can reconnect and retry ([11840](https://github.com/civicrm/civicrm-core/pull/11840))**

- **dev/mail#1 - Modify message text for pause mailing ([12284](https://github.com/civicrm/civicrm-core/pull/12284))**

- **Partial refactor of completeMembershipFromContribution ([12271](https://github.com/civicrm/civicrm-core/pull/12271))**

- **merge to master ([12285](https://github.com/civicrm/civicrm-core/pull/12285))**

- **Add unit test for CRM_Core_BAO_CustomField::getCustomFieldID ([12283](https://github.com/civicrm/civicrm-core/pull/12283))**

- **core/#170 minimal fix for fatal on soft_credit field ([12282](https://github.com/civicrm/civicrm-core/pull/12282))**

- **dev/core#165 - Fix case activity breadcrumb ([12279](https://github.com/civicrm/civicrm-core/pull/12279))**

- **dev/financial#14 Fix enotices & inability to cancel recurring on paypal express ([12091](https://github.com/civicrm/civicrm-core/pull/12091))**

- **dev/core#134 Search Builder broken filter for Source Contact ID ([12181](https://github.com/civicrm/civicrm-core/pull/12181))**

- **[NFC] Fix line endings (Jenkins where were you) ([12280](https://github.com/civicrm/civicrm-core/pull/12280))**

- **Mail#1 - Add pause/resume functionality to civicrm bulk mailing ([11803](https://github.com/civicrm/civicrm-core/pull/11803))**

- **dev/core#140 add missing pseudoconstant for option_group_id in CustomField.xml ([12195](https://github.com/civicrm/civicrm-core/pull/12195))**

- **dev/accessiblity#3 Remove orphan label tag from Event pages ([12209](https://github.com/civicrm/civicrm-core/pull/12209))**

- **Towards fixing household merge export, extract function, add test, fix prev ([12272](https://github.com/civicrm/civicrm-core/pull/12272))**

- **dev/core/#152 - AdvMulti-Select cleanup ([531](https://github.com/civicrm/civicrm-drupal/pull/531))**

- **Do not render shortcodes in PUT, POST or DELETE ([130](https://github.com/civicrm/civicrm-wordpress/pull/130))**

- **Fix dev/joomla#1 - Fix list of events shown when adding an Event Info and Registration pages ([46](https://github.com/civicrm/civicrm-joomla/pull/46))**

- **(dev/core#174) Import PSR-16 compliance test ([215](https://github.com/civicrm/civicrm-packages/pull/215))**

- **dev/accessiblity#3 Add aria-label to sub elements of Quickform date field ([213](https://github.com/civicrm/civicrm-packages/pull/213))**

- **Standardise line endings away from windows line endings to linux ([212](https://github.com/civicrm/civicrm-packages/pull/212))**

- **Upgrade Mime_mail to fix issues with PHP7.2 ([205](https://github.com/civicrm/civicrm-packages/pull/205))**

- **Apply fixes to have DB package support PHP7.2 ([207](https://github.com/civicrm/civicrm-packages/pull/207))**

- **dev/core#117 Replace useage of deprecated function each with foreach … ([211](https://github.com/civicrm/civicrm-packages/pull/211))**

- **Declare Subparts as array in mimePart to support PHP7.2 ([210](https://github.com/civicrm/civicrm-packages/pull/210))**

### CiviCRM API

- **[CRM-20711](https://issues.civicrm.org/jira/browse/CRM-20711) Error - DB Constraint Violation - GroupContact, get API ([12408](https://github.com/civicrm/civicrm-core/pull/12408))**

### CiviMail

- **[CRM-17753](https://issues.civicrm.org/jira/browse/CRM-17753) Newsletter confirmation emails shouldn't use do-not-reply@yourdomain.org ([12270](https://github.com/civicrm/civicrm-core/pull/12270))**

- **[CRM-21779](https://issues.civicrm.org/jira/browse/CRM-21779) Civimail allows adding current draft mailing recipients to recipients field ([11724](https://github.com/civicrm/civicrm-core/pull/11724))**

### CiviContribute

- **[CRM-20697](https://issues.civicrm.org/jira/browse/CRM-20697) Online pay now anomalies (contribution transfer to new contact)  ([11578](https://github.com/civicrm/civicrm-core/pull/11578))**

### CiviCRM API, NYSS

- **[CRM-19798](https://issues.civicrm.org/jira/browse/CRM-19798) Memory leak in API3 EntityTag get operations ([12276](https://github.com/civicrm/civicrm-core/pull/12276))**

### CiviContribute, CiviMember

- **[CRM-21177](https://issues.civicrm.org/jira/browse/CRM-21177) Wrong interval of recurring payment for auto-renewing membership ([12289](https://github.com/civicrm/civicrm-core/pull/12289))**

### WordPress Integration

- **[CRM-21565](https://issues.civicrm.org/jira/browse/CRM-21565) Change mkdir to use correct and more secure mode numbers ([120](https://github.com/civicrm/civicrm-wordpress/pull/120))**

## <a name="misc"></a>Miscellany

## <a name="credits"></a>Credits

This release was developed by the following code authors:

AGH Strategies - Alice Frumin, Andrew Hunt; Agileware - Alok Patel; Australian Greens - Seamus Lee; bastienho; CiviCoop - Jaap Jansma; CiviCRM - Coleman Watts, Tim Otten; CiviDesk - Yashodha Chaku; CompuCorp - Camilo Rodriguez, Michael Devery, René Olivo, Vinu Varshith Sekar; Electronic Frontier Foundation - Mark Burdett; Fuzion - Jitendra Purohit; Ginkgo Street Labs - Frank Gómez; JMA Consulting - Monish Deb; Johan Vervloet; John Kingsnorth; Kanzu Code - Carl Andrew Lema; Left Join Labs - Sean Madsen; MJW Consulting - Matthew Wire; Pradeep Nayak; Romain Thouvenin; Squiffle Consulting - Aidan Saunders; Tadpole Collective - Kevin Cristiano; Third Sector Design - Michael McAndrew; Tom Bloor; We Move Europe/Caltha - Tomasz Pietrzkowski; Wikimedia Foundation - Eileen McNaughton

Most authors also reviewed code for this release; in addition, the following
reviewers contributed their comments:

AGH Strategies - Andrew Hunt; Agileware - Justin Freeman; Australian Greens - Seamus Lee; baernm; bastienho; Blackfly Solutions - Alan Dixon; Bob Silvern; Borislav Zlatanov; cartbar; Christian Wach; Circle Interactive - Dave Jenkins; CiviCoop - Erik Hommel; civicrm-builder; CiviCRM - Coleman Watts; civicrm-org[bot]; CiviDesk - Yashodha Chaku; Community Builders - Andrew Perry; CompuCorp - Camilo Rodriguez, Guanhuan Chen, Omar Abu Hussein, René Olivo, Vinu Varshith Sekar; Coop SymbioTIC - Mathieu Lutfy; drupal_lizz; Electronic Frontier Foundation - Mark Burdett; Evan Chute; Forest CRM Consulting - Tamar Meir; Freeform Solutions - Herb van den Dool; Fuzion - Jitendra Purohit; Ginkgo Street Labs - Dan O'Brien, Frank Gómez; hugo.carmo; JMA Consulting - Joe Murray, Monish Deb; Johan Vervloet; John Kingsnorth; Left Join Labs - Sean Madsen; Lemniscus - Noah Miller; Lighthouse Design and Consulting - Brian Shaughnessy; Megaphone Technology Consulting - Jon Goldberg; michau; MikeyMJCO; MJW Consulting - Matthew Wire; Oxfam Germany - Thomas Schüttler; Pradeep Nayak; Richard van Oosterhout; robfenwickuk; Romain Thouvenin; Semper IT - Karin Gerritsen; Squiffle Consulting - Aidan Saunders; Stephen Palmstrom; Tadpole Collective - Kevin Cristiano; Tech To The People - Xavier Dutoit; Third Sector Design - Michael McAndrew; Timbsoft Technologies - Tunbola Ogunwande; Tom Bloor; We Move Europe/Caltha - Tomasz Pietrzkowski; Wikimedia Foundation - Eileen McNaughton

## <a name="feedback"></a>Feedback

These release notes are edited by Alice Frumin and Andrew Hunt.  If you'd like
to provide feedback on them, please login to https://chat.civicrm.org/civicrm
and contact `@agh1`.
